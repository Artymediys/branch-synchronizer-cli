# BSync – Branch Synchronizer

CLI-версия приложения для синхронизации веток в проектах GitLab.  
Оригинал: https://github.com/Artymediys/branch-synchronizer

## Интерфейс
Пользовательский интерфейс состоит из нескольких этапов:

0) **Конфигурация приложения** – на этом этапе предлагается ввести следующие поля:
    - `GitLab URL` – Адрес GitLab. Пример: https://gitlab.example.com
    - `GitLab PAT` – Personal Access Token, который можно получить в настройках юзера: _User settings –> Access tokens_
    - `Mattermost URL` – Адрес Mattermost (по аналогии с GitLab). Пример: https://mattermost.example.team
    - `Mattermost Bot Token` – Токен бота, от лица которого будут отправляться сообщения
    - `Mattermost Channel ID` – ID канала, куда будут отправляться сообщения

   Этот этап появляется только при первом запуске, после чего введённые данные сохраняются в файл `.bsync_cli.yaml`
   в домашней директории пользователя.

1) **Выбор группы и проектов внутри этой группы** – этап делится на две части:
    1) Выбор одной из групп, доступных вашему пользователю
    2) Выбор проектов, входящих в указанную группу, с помощью английской буквы `x`.
       Также доступны поиск по названию, который можно активировать с помощью символа `/`, и возврат к выбору группы с помощью клавиши `Tab`

2) **Выбор исходной (source) и целевой (target) ветки** – на этом этапе отображаются общие ветки для ранее выбранных проектов.
    - Сначала предлагается выбрать исходную ветку, а затем выбрать целевую ветку
    - Все бинды (горячие клавиши) работают аналогично предыдущему этапу
   
   После этого происходит проверка различий веток у выбранных проектов

3) **Подтверждение действий** – на этом этапе отображаются проекты с найденными различиями в указанных ветках.
    - Если утвердить выбор, то запустится процесс создания МРов в этих проектах
    - Если отклонить выбор, то программа завершит своё выполнение
    - Если различий не было найдено, то программа также предложит завершить свою работу

## Логирование
В процессе работы приложения, формируется два лог-файла, которые находятся в директории `logs`,
создающейся по тому же пути, где находится приложение:
- `bsync_cli_main.log` - Содержит записи всех действий, происходящих в процессе работы приложения
- `bsync_cli_result_<data>.log` - Содержит статусы выполнения ключевых событий релиза

## Сборка и запуск
В директории `./bin` лежат сборки приложения под разные ОС.

### Запуск собранного приложения
Приложение не имеет каких-либо аргументов и флагов.
Для запуска требуется обратиться к файлу, который находится в директории с требуемой ОС и архитектурой:
```shell
./bin/<ОС>/bsync_cli_<архитектура>
```

### Самостоятельная сборка
Для самостоятельной сборки и последующего запуска, требуется установленный **Go** версии `>=1.23.1`.

В корне репозитория находится bash-скрипт `build.sh` для сборки приложения под необходимую ОС и архитектуру.

Скрипт можно запустить вместе с аргументами:
1) Сборка приложения под предустановленные ОС и архитектуры, а именно –> **windows amd64**; **linux amd64**;
   **macos amd64** и **arm64**
```shell
./build.sh all
```

2) Сборка приложения под конкретную ОС. Из доступных вариантов -> **windows**; **linux**, **macos**
```shell
./build.sh <ОС>
```

Также скрипт можно запустить без аргументов. Тогда он соберёт приложение под текущую ОС и архитектуру,
на которой был запущен скрипт:
```shell
./build.sh
```

Если требуется собрать приложение под ОС или архитектуру, которой нет в стандартном наборе скрипта `build.sh`,
тогда можно посмотреть список доступных для сборки ОС и архитектуры командой:
```shell
go tool dist list
```
после чего выполнить следующую команду для сборки:

**Linux/MacOS**
```shell
env GOOS=<ОС> GOARCH=<архитектура> go build -o <название итогового файла>
```

**Windows/Powershell**
```shell
$env:GOOS="<ОС>"; $env:GOARCH="<архитектура>"; go build -o <название итогового файла>
```

**Windows/cmd**
```shell
set GOOS=<ОС> && set GOARCH=<архитектура> && go build -o <название итогового файла>
```